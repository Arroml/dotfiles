########## PLUGINS ##########
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'hendrikmi/tmux-cpu-mem-monitor'
set -g @plugin 'omerxx/tmux-sessionx'

########## GENERAL ##########
set -g base-index 1
setw -g pane-base-index 1
set -g mode-keys vi
# alten Prefix entfernen
unbind C-b

# Prefix auf Meta-a (Alt-a)
set -g prefix M-a
bind M-a send-prefix
# Copy to system clipboard
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
# Neues Fenster im aktuellen Verzeichnis öffnen
bind c new-window -c "#{pane_current_path}"
########## WINDOW SWITCHING (MIT PREFIX) ##########

# Prefix (M-a) + a s d f g → Fenster 1–5
bind a select-window -t 1
bind s select-window -t 2
bind d select-window -t 3
bind f select-window -t 4
bind g select-window -t 5
########## SESSIONX SETTINGS ##########
set -g @sessionx-bind 'k'
set -g @sessionx-x-path "$HOME/dotfiles"
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-zoxide-mode 'on'

########## COLORS (Gruvbox Dark Soft) ##########
set -g status-position top

bg="#282828"
default_fg="#ebdbb2"

session_fg="#fabd2f"
session_selection_fg="#282828"
session_selection_bg="#d79921"

active_window_fg="#fabd2f"
active_pane_border="#d79921"
inactive_pane_border="#504945"

status_bg="#3c3836"
status_fg="#ebdbb2"

########## STATUS BAR ##########
set -g status-left-length 200
set -g status-right-length 200

set -g status-style "bg=${bg},fg=${default_fg}"
set -g status-left "#[fg=${session_fg},bold,bg=${bg}] #S #[fg=${default_fg},nobold,bg=${bg}] | "
set -g status-right " #{cpu -i 3}   #{mem}"

# --- Window index -> a s d f g mapping ---
set -g window-status-format "#[fg=${default_fg},bg=default] \
#{?#{==:#{window_index},1},a,\
#{?#{==:#{window_index},2},s,\
#{?#{==:#{window_index},3},d,\
#{?#{==:#{window_index},4},f,\
#{?#{==:#{window_index},5},g,\
#{window_index}}}}}}:#{window_name}"

set -g window-status-current-format "#[fg=${active_window_fg},bold,bg=default]  #[underscore]\
#{?#{==:#{window_index},1},a,\
#{?#{==:#{window_index},2},s,\
#{?#{==:#{window_index},3},d,\
#{?#{==:#{window_index},4},f,\
#{?#{==:#{window_index},5},g,\
#{window_index}}}}}}:#{window_name}"
set -g window-status-last-style "fg=${default_fg},bg=default"

set -g message-style "bg=default,fg=${default_fg}"
set -g message-command-style "bg=default,fg=${default_fg}"
set -g mode-style "bg=${session_selection_bg},fg=${session_selection_fg}"

########## PANES ##########
set -g pane-active-border-style "fg=${active_pane_border},bg=default"
set -g pane-border-style "fg=${inactive_pane_border},bg=default"

########## COPY MODE ##########
bind Escape copy-mode -e
########## COPY MODE (vi, korrekt) ##########

# Cursor bewegen (Standard, nur zur Klarheit)
bind -T copy-mode-vi h send -X cursor-left
bind -T copy-mode-vi j send -X cursor-down
bind -T copy-mode-vi k send -X cursor-up
bind -T copy-mode-vi l send -X cursor-right
bind -T copy-mode-vi w send -X next-word
bind -T copy-mode-vi b send -X previous-word
bind -T copy-mode-vi e send -X next-word-end

# VISUAL MODE START
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line

# YANK (Auswahl → Clipboard)
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# Abbrechen
bind -T copy-mode-vi Escape send -X cancel

########## CONTINUUM/RESURRECT ##########
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-save-interval '15'
set -g @continuum-restore 'on'

########## LAST WINDOW TOGGLE ##########
bind l switch-client -l

########## INIT TPM (MUSS GANZ UNTEN BLEIBEN) ##########
run '~/.tmux/plugins/tpm/tpm'
